<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>一个开发</title>
  
  <subtitle>不够精彩的生活和工作也需要记录一下</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yigekaifa.com/"/>
  <updated>2020-03-10T20:57:50.478Z</updated>
  <id>https://yigekaifa.com/</id>
  
  <author>
    <name>一个开发</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="https://yigekaifa.com/hello-world/"/>
    <id>https://yigekaifa.com/hello-world/</id>
    <published>2020-03-10T20:57:50.478Z</published>
    <updated>2020-03-10T20:57:50.478Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>PowerShell禁止执行脚本的解决方法</title>
    <link href="https://yigekaifa.com/script-cant-run-on-powershell/"/>
    <id>https://yigekaifa.com/script-cant-run-on-powershell/</id>
    <published>2020-03-10T18:26:23.000Z</published>
    <updated>2020-03-10T19:34:14.407Z</updated>
    
    <content type="html"><![CDATA[<p>如果出现类似下面的提示：</p><pre><code class="bash">无法加载文件 ******.xxx，因为在此系统中禁止执行脚本。有关详细信息，请参阅 &quot;get-help about_signing&quot;。所在位置 行:1 字符: 17</code></pre><p>解决方法：</p><a id="more"></a><p>运行<code>Get-ExecutionPolicy</code>。如果返回<code>Restricted</code>，然后运行<code>set-ExecutionPolicy RemoteSigned</code></p><p>然后就可以运行命令了。</p><p>另外如果还不能执行，例如你npm安装的一些命令不能运行，那么请你把<code>C:\Users\用户名\AppData\Roaming\npm</code>添加到系统变量<code>Path</code>里面。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;如果出现类似下面的提示：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;无法加载文件 ******.xxx，因为在此系统中禁止执行脚本。有关详细信息，请参阅 &amp;quot;get-help about_signing&amp;quot;。
所在位置 行:1 字符: 17
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;解决方法：&lt;/p&gt;
    
    </summary>
    
    
      <category term="Note" scheme="https://yigekaifa.com/categories/Note/"/>
    
    
      <category term="PowerShell" scheme="https://yigekaifa.com/tags/PowerShell/"/>
    
      <category term="Script" scheme="https://yigekaifa.com/tags/Script/"/>
    
  </entry>
  
  <entry>
    <title>Linux下DD命令进度查看</title>
    <link href="https://yigekaifa.com/dd-cmd-on-linux/"/>
    <id>https://yigekaifa.com/dd-cmd-on-linux/</id>
    <published>2020-03-10T18:25:06.000Z</published>
    <updated>2020-03-10T19:34:02.935Z</updated>
    
    <content type="html"><![CDATA[<p>在Ubuntu 系统上执行如下命令</p><pre><code class="shell"> dd if=/img.iso of=/dev/mydevice bs=10M count=100000</code></pre><a id="more"></a><p>有的时候，可能会非常耗时，这个时候，如果让dd命令输出执行进度信息，会非常有用。</p><p>重新打开一个Shell，然后执行如下命令即可每秒输出一次进度信息</p><pre><code class="Shell"> watch -n 1 pkill -USR1 -x dd</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在Ubuntu 系统上执行如下命令&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;shell&quot;&gt; dd if=/img.iso of=/dev/mydevice bs=10M count=100000&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
    
      <category term="Note" scheme="https://yigekaifa.com/categories/Note/"/>
    
    
      <category term="Linux" scheme="https://yigekaifa.com/tags/Linux/"/>
    
      <category term="cmd" scheme="https://yigekaifa.com/tags/cmd/"/>
    
  </entry>
  
  <entry>
    <title>自带清除内容功能的EditText</title>
    <link href="https://yigekaifa.com/edittext-with-clear-icon/"/>
    <id>https://yigekaifa.com/edittext-with-clear-icon/</id>
    <published>2020-03-10T18:23:58.000Z</published>
    <updated>2020-03-10T19:34:08.799Z</updated>
    
    <content type="html"><![CDATA[<p>出发需求：</p><ol><li>减少手写清除EditText内容的代码</li><li>xml里面写的话，点击清除按钮会失去焦点，然后软键盘消失，需要重复点击输入框才可以继续输入<a id="more"></a><pre><code class="java"></code></pre></li></ol><p>public class ClearEditText extends AppCompatEditText implements View.OnFocusChangeListener, View.OnTouchListener, TextWatcher {</p><pre><code>private Drawable mClearTextIcon;private OnFocusChangeListener mOnFocusChangeListener;private OnTouchListener mOnTouchListener;private boolean isShowClearIcon;public ClearEditText(Context context) {    super(context);    init(context, null);}public ClearEditText(Context context, AttributeSet attrs) {    super(context, attrs);    init(context, attrs);}public ClearEditText(Context context, AttributeSet attrs, int defStyleAttr) {    super(context, attrs, defStyleAttr);    init(context, attrs);}private void init(Context context, AttributeSet attrs) {    mClearTextIcon = getCompoundDrawables()[2];    TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.ClearEditText);    isShowClearIcon = typedArray.getBoolean(R.styleable.ClearEditText_isShowClearIcon, true);    if (mClearTextIcon == null) {        final Drawable drawable = ContextCompat.getDrawable(context, R.mipmap.icon_clear_text);        final Drawable wrapDrawable = DrawableCompat.wrap(drawable);        DrawableCompat.setTint(wrapDrawable, getCurrentHintTextColor());        mClearTextIcon = wrapDrawable;    }    mClearTextIcon.setBounds(0, 0, mClearTextIcon.getIntrinsicHeight(), mClearTextIcon.getIntrinsicHeight());    setClearIconVisible(false);    super.setOnFocusChangeListener(this);    super.setOnTouchListener(this);    addTextChangedListener(this);}public void setmOnFocusChangeListener(OnFocusChangeListener mOnFocusChangeListener) {    this.mOnFocusChangeListener = mOnFocusChangeListener;}public void setmOnTouchListener(OnTouchListener mOnTouchListener) {    this.mOnTouchListener = mOnTouchListener;}private void setClearIconVisible(boolean visible) {    mClearTextIcon.setVisible(visible &amp;&amp; isShowClearIcon, false);    final Drawable[] compoundDrawables = getCompoundDrawables();    setCompoundDrawables(            compoundDrawables[0],            compoundDrawables[1],            visible ? mClearTextIcon : null,            compoundDrawables[3]);}@Overridepublic void onFocusChange(View v, boolean hasFocus) {    if (hasFocus) {        setClearIconVisible(getText().length() &gt; 0);    } else {        setClearIconVisible(false);    }    if (mOnFocusChangeListener != null) {        mOnFocusChangeListener.onFocusChange(v, hasFocus);    }}@Overridepublic boolean onTouch(View v, MotionEvent motionEvent) {    int x = (int) motionEvent.getX();    if (mClearTextIcon.isVisible() &amp;&amp; x &gt; getWidth() - getPaddingRight() - mClearTextIcon.getIntrinsicWidth()) {        if (motionEvent.getAction() == motionEvent.ACTION_UP) {            setError(null);            setText(&quot;&quot;);        }        return true;    }    return (mOnTouchListener != null &amp;&amp; mOnTouchListener.onTouch(v, motionEvent));}public void isShowClearIcon(boolean isShowClearIcon) {    this.isShowClearIcon = isShowClearIcon;    setClearIconVisible(getText().length() &gt; 0);}@Overridepublic void onTextChanged(CharSequence text, int start, int lengthBefore, int lengthAfter) {    if (isFocused()) {        setClearIconVisible(text.length() &gt; 0);    }}@Overridepublic void beforeTextChanged(CharSequence s, int start, int count, int after) {}@Overridepublic void afterTextChanged(Editable s) {}</code></pre><p>}</p><pre><code>attrs：```xml    &lt;declare-styleable name=&quot;ClearEditText&quot;&gt;        &lt;!--是否需要展示清除按钮--&gt;        &lt;attr name=&quot;isShowClearIcon&quot; format=&quot;boolean&quot;/&gt;    &lt;/declare-styleable&gt;</code></pre><p>使用</p><pre><code class="xml">&lt;xxx.ClearEditText&gt;    &lt;!--some parms here--&gt;    ...    &lt;!--set is show the icon here--&gt;    app:isShowClearIcon = &quot;true&quot;&lt;/ClearEditText&gt;</code></pre><p>或者在<code>java</code>代码中:</p><pre><code class="java">clearTextView.isShowClearIcon(true);</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;出发需求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;减少手写清除EditText内容的代码&lt;/li&gt;
&lt;li&gt;xml里面写的话，点击清除按钮会失去焦点，然后软键盘消失，需要重复点击输入框才可以继续输入
    
    </summary>
    
    
      <category term="Dev" scheme="https://yigekaifa.com/categories/Dev/"/>
    
    
      <category term="Edittext" scheme="https://yigekaifa.com/tags/Edittext/"/>
    
      <category term="Custom" scheme="https://yigekaifa.com/tags/Custom/"/>
    
  </entry>
  
  <entry>
    <title>监听布局内所有的EditText</title>
    <link href="https://yigekaifa.com/listen-all-edittext-in-your-layout/"/>
    <id>https://yigekaifa.com/listen-all-edittext-in-your-layout/</id>
    <published>2020-03-10T15:49:23.000Z</published>
    <updated>2020-03-10T18:15:58.298Z</updated>
    
    <content type="html"><![CDATA[<p>当出现布局内有N个输入框且需要同步监听，例如你需要监听用户输入所有内容之后才可以点击下一步的控件，你可以试试下面这个控件。</p><a id="more"></a><h2 id="1-获取子view"><a href="#1-获取子view" class="headerlink" title="1. 获取子view"></a>1. 获取子view</h2><p>编历布局，看当前布局有几个<code>EditText</code>,然后去监听拿到<code>focus</code>的<code>view</code></p><p>获取子<code>view</code>的方式：</p><pre><code class="java">// 遍历viewGroup    public int traverseViewGroup(View view) {        int viewCount = 0;        if (null == view) {            return 0;        }        if (view instanceof ViewGroup) {            //遍历ViewGroup,是子view加1，是ViewGroup递归调用            for (int i = 0; i &lt; ((ViewGroup) view).getChildCount(); i++) {                View child = ((ViewGroup) view).getChildAt(i);                if (child instanceof ViewGroup) {                    viewCount += traverseViewGroup(((ViewGroup) view).getChildAt(i));                } else {                    viewCount++;                }            }        } else {            viewCount++;        }        return viewCount;    }</code></pre><p>非递归方法获取子<code>view</code>：</p><pre><code class="java"> // 遍历viewGroup    public int traverseViewGroup(View view) {        int viewCount = 0;        if (null == view) {            return 0;        }        if (view instanceof ViewGroup) {            ViewGroup viewGroup = (ViewGroup) view;            LinkedList&lt;ViewGroup&gt; linkedList = new LinkedList&lt;&gt;();            linkedList.add(viewGroup);            while (!linkedList.isEmpty()) {                //removeFirst()删除第一个元素，并返回该元素                ViewGroup current = linkedList.removeFirst();                viewCount++;                //遍历linkedList中第一个viewGroup中的子view                for (int i = 0; i &lt; current.getChildCount(); i++) {                    if (current.getChildAt(i) instanceof ViewGroup) {                        linkedList.addLast((ViewGroup) current.getChildAt(i));                    } else {                        viewCount++;                    }                }            }        } else {            viewCount++;        }        return viewCount;    }</code></pre><p>获取到子<code>view</code>的时候，你需要判断这个子<code>view</code>是不是<code>EditText</code>，方法有两种：</p><pre><code class="java">v.getClassName() == &quot;EditText&quot;</code></pre><pre><code class="java">v instanceof Button</code></pre><h2 id="2-拿到子view之后："><a href="#2-拿到子view之后：" class="headerlink" title="2. 拿到子view之后："></a>2. 拿到子view之后：</h2><p>方法1. 拿到子<code>view</code>之后，不需要每个都去监听（当然你也可以这么做），另外一种，判断在<code>viewgroup</code>中哪个子<code>view</code>获取到了焦点，然后给他添加监听，其他的移除监听。</p><p>然后给设置的按钮去设置<code>enable</code></p><p>方法2. LiveData监听数据变化，但是和上面的方式换汤不换药，代码量更多了一点。LiveData的具体使用可以参考： <a href="https://developer.android.google.cn/reference/android/arch/lifecycle/LiveData" target="_blank" rel="noopener">https://developer.android.google.cn/reference/android/arch/lifecycle/LiveData</a></p><h3 id="需要完成的内容："><a href="#需要完成的内容：" class="headerlink" title="需要完成的内容："></a>需要完成的内容：</h3><ul><li><input checked="" disabled="" type="checkbox"> 添加例外的参数，例如非必填的Edittext</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当出现布局内有N个输入框且需要同步监听，例如你需要监听用户输入所有内容之后才可以点击下一步的控件，你可以试试下面这个控件。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Dev" scheme="https://yigekaifa.com/categories/Dev/"/>
    
    
      <category term="Edittext" scheme="https://yigekaifa.com/tags/Edittext/"/>
    
      <category term="ViewGroup" scheme="https://yigekaifa.com/tags/ViewGroup/"/>
    
      <category term="CustomView" scheme="https://yigekaifa.com/tags/CustomView/"/>
    
  </entry>
  
  <entry>
    <title>startWithPop()出现两个Fragment都退出的情况</title>
    <link href="https://yigekaifa.com/startwithpop-close-both-fragment/"/>
    <id>https://yigekaifa.com/startwithpop-close-both-fragment/</id>
    <published>2020-03-10T15:37:18.000Z</published>
    <updated>2020-03-10T19:34:18.671Z</updated>
    
    <content type="html"><![CDATA[<p>有时候<code>startWithPop()</code>会出现两个<code>Fragment</code>都出栈的情况，一般当前<code>fragment</code>是RootView的时候会出现这个情况。</p><a id="more"></a><p>解决方法：</p><pre><code class="java">((BaseFragment) getParentFragment()).start(toFragment);</code></pre><p>或者</p><pre><code class="java">popTo(A.class,true,new Runnable(){       @Override       public void run() {            start(B);       }},getFragmentAnimator().getPopExit()); // getFragmentAnimator().getPopExit() 代表popTo时的动画</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;有时候&lt;code&gt;startWithPop()&lt;/code&gt;会出现两个&lt;code&gt;Fragment&lt;/code&gt;都出栈的情况，一般当前&lt;code&gt;fragment&lt;/code&gt;是RootView的时候会出现这个情况。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Dev" scheme="https://yigekaifa.com/categories/Dev/"/>
    
    
      <category term="startWithPop" scheme="https://yigekaifa.com/tags/startWithPop/"/>
    
      <category term="Fragment" scheme="https://yigekaifa.com/tags/Fragment/"/>
    
  </entry>
  
  <entry>
    <title>TabLayout的简单修改</title>
    <link href="https://yigekaifa.com/some-changes-for-tablayout/"/>
    <id>https://yigekaifa.com/some-changes-for-tablayout/</id>
    <published>2020-03-10T15:11:19.000Z</published>
    <updated>2020-03-10T15:13:14.895Z</updated>
    
    <content type="html"><![CDATA[<p>设计稿上的tab布局我用了design库的tablayout，根据设计上的图来看，选中的tab要是粗体，下方横线等宽于字体。</p><a id="more"></a><h3 id="问题1：TabLayout无法控制当前选中的行的字体"><a href="#问题1：TabLayout无法控制当前选中的行的字体" class="headerlink" title="问题1：TabLayout无法控制当前选中的行的字体"></a>问题1：TabLayout无法控制当前选中的行的字体</h3><p>解决方案：<code>setCustomView()</code> 。</p><p>首先写一个方法，用来返回每个tab的view：</p><pre><code class="java">    public View getTabView(int position, String title) {        View view = LayoutInflater.from(getContext()).inflate(R.layout.tab_item, null);        TextView txt_title = (TextView) view.findViewById(R.id.textView);        txt_title.setText(title);        return view;    }</code></pre><p>然后把view设置到tablayout中：</p><pre><code class="java">tabLayout.getTabAt(0).setCustomView(getTabView(0, &quot;全部&quot;));</code></pre><p>然后去选择控制tablayout的标签的样式，我是新建了一个OnTabSelectedListener，然后再里面进行设置的</p><pre><code class="java">OnTabSelectedListener onTabSelectedListener = new TabLayout.OnTabSelectedListener() {            @Override            public void onTabSelected(TabLayout.Tab tab) {                // 选中的tab设置为粗体                TextView textView = tabLayout.getTabAt(tab.getPosition()).getCustomView().findViewById(R.id.textView);                textView.setTypeface(null, Typeface.BOLD);                viewPager.setCurrentItem(tab.getPosition());            }            @Override            public void onTabUnselected(TabLayout.Tab tab) {                // 未选中的tab设置为正常                TextView textView = tabLayout.getTabAt(tab.getPosition()).getCustomView().findViewById(R.id.textView);                textView.setTypeface(null, Typeface.NORMAL);            }            @Override            public void onTabReselected(TabLayout.Tab tab) {            }        };</code></pre><p>但是，设置好之后出现了新的问题：</p><h3 id="问题2：下面Indicator宽度始终为最宽的宽度"><a href="#问题2：下面Indicator宽度始终为最宽的宽度" class="headerlink" title="问题2：下面Indicator宽度始终为最宽的宽度"></a>问题2：下面<code>Indicator</code>宽度始终为最宽的宽度</h3><p>即使你设置了<code>app:tabIndicatorFullWidth=&quot;true&quot;</code>，因为<code>tabIndicatorFullWidth</code>是根据默认布局的文字宽度来设置的，我们自定义布局之后，系统无法获取到文字大小和长度，所以就会设置成最宽的宽度。</p><p>我的解决方法：</p><pre><code class="java">public void reflex(final TabLayout tabLayout) {        tabLayout.post(new Runnable() {            @Override            public void run() {                try {                    LinearLayout mTabStrip = (LinearLayout) tabLayout.getChildAt(0);                    for (int i = 0; i &lt; mTabStrip.getChildCount(); i++) {                        View tabView = mTabStrip.getChildAt(i);                        Field mTextViewField = tabView.getClass().getDeclaredField(&quot;textView&quot;);                        mTextViewField.setAccessible(true);                        TextView mTextView = (TextView) mTextViewField.get(tabView);                        tabView.setPadding(0, 0, 0, 0);                        int width = 0;                        width = mTextView.getWidth();                        if (width == 0) {                            mTextView.measure(0, 0);                            width = mTextView.getMeasuredWidth();                        }                        LinearLayout.LayoutParams params = (LinearLayout.LayoutParams) tabView.getLayoutParams();                        params.width = width;                        WindowManager wm1 = ((Activity) getContext()).getWindowManager();                        int width1 = wm1.getDefaultDisplay().getWidth();                        LogUtils.d(&quot;&quot; + width1 / tabLayout.getTabCount() + &quot;=============&quot; + mTextView.getText().length() * dip2px(tabLayout.getContext(), 15));                        params.leftMargin = (width1 / tabLayout.getTabCount() - mTextView.getText().length() * dip2px(tabLayout.getContext(), 15)) / 2;                        params.rightMargin = (width1 / tabLayout.getTabCount() - mTextView.getText().length() * dip2px(tabLayout.getContext(), 15)) / 2;                        tabView.setLayoutParams(params);                        tabView.invalidate();                    }                } catch (NoSuchFieldException e) {                    e.printStackTrace();                } catch (IllegalAccessException e) {                    e.printStackTrace();                }            }        });    }    public static int dip2px(Context context, float dpValue) {        float scale = context.getResources().getDisplayMetrics().density;        return (int) (dpValue * scale + 0.5f);    }</code></pre><p><code>reflex(tabLayout);</code>调用在所有<code>getTabAt</code>方法之后即可解决这个，但是还有点小问题，tab大小被设置成了文字宽度…这个问题暂时保留，下次解决。另外有几个小问题</p><ol><li>去掉tab的水波纹效果，无论是support还是AdnroidX，都用<code>app:tabRippleColor=&quot;@android:color/transparent&quot;</code>，<code>app:tabBackground=&quot;@android:color/transparent&quot;</code>即使在support下也无效</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;设计稿上的tab布局我用了design库的tablayout，根据设计上的图来看，选中的tab要是粗体，下方横线等宽于字体。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Dev" scheme="https://yigekaifa.com/categories/Dev/"/>
    
    
      <category term="TabLayout" scheme="https://yigekaifa.com/tags/TabLayout/"/>
    
      <category term="widget" scheme="https://yigekaifa.com/tags/widget/"/>
    
      <category term="custom" scheme="https://yigekaifa.com/tags/custom/"/>
    
  </entry>
  
  <entry>
    <title>Android中几种定位方式的粗解</title>
    <link href="https://yigekaifa.com/some-way-to-get-location/"/>
    <id>https://yigekaifa.com/some-way-to-get-location/</id>
    <published>2020-03-10T14:46:16.000Z</published>
    <updated>2020-03-10T15:00:31.759Z</updated>
    
    <content type="html"><![CDATA[<p>之前朋友问我Tiktok为什么禁用了定位，开启了全局代理，还是可以获取到位置。当时想法只有一个：基站定位。我让他在设置里关掉移动服务（关闭手机卡）之后，确实可以正常使用了。</p><p>这里简单说一下Android中集中定位方式。</p><a id="more"></a><blockquote><p>这里是在Android10添加的新权限，在后台获取位置：<a href="https://developer.android.com/reference/android/Manifest.permission.html#ACCESS_BACKGROUND_LOCATION" target="_blank" rel="noopener">https://developer.android.com/reference/android/Manifest.permission.html#ACCESS_BACKGROUND_LOCATION</a></p></blockquote><h2 id="1-GPS"><a href="#1-GPS" class="headerlink" title="1. GPS"></a>1. GPS</h2><p>权限（注意版本变化）：</p><pre><code class="xml">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;</code></pre><p>具体定位代码</p><pre><code class="java">var locManager = getSystemService(Context.LOCATION_SERVICE) as LocationManagervar loc = locManager.getLastKnownLocation(LocationManager.GPS_PROVIDER)if(loc != null){    Log.e(&quot;gpslocation&quot;, loc.toString())    toast(loc.toString())}locManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0F, object : LocationListener{    override fun onStatusChanged(provider: String?, status: Int, extras: Bundle?) {    }    override fun onProviderEnabled(provider: String?) {    }    override fun onProviderDisabled(provider: String?) {    }    override fun onLocationChanged(location: Location?) {        Log.e(&quot;gpslocation&quot;, location.toString())        toast(location.toString())    }})</code></pre><h3 id="2-Network获取位置"><a href="#2-Network获取位置" class="headerlink" title="2. Network获取位置"></a>2. Network获取位置</h3><p>与GPS定位相同，代码都一样。只是申请权限不同。并且在室内时，GPS需要一定时间来定位，而Network在网络状况不好时不可用。</p><h3 id="3-IP"><a href="#3-IP" class="headerlink" title="3. IP"></a>3. IP</h3><p>APP通过对当前IP的分析，可以得到你大致的位置。一般不采用这种方案，IP太容易被伪装。</p><h3 id="4-WiFi（WLAN）定位"><a href="#4-WiFi（WLAN）定位" class="headerlink" title="4. WiFi（WLAN）定位"></a>4. WiFi（WLAN）定位</h3><p>需要权限：</p><pre><code class="xml">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;/&gt;</code></pre><p>这个也比较简单，就是过程就是拿到当前的WiFi信息，然后通过mac地址（BSSID）进行查询。具体查询的接口可以去聚合数据搜索一下，这里不再多说。</p><h3 id="5-基站定位"><a href="#5-基站定位" class="headerlink" title="5. 基站定位"></a>5. 基站定位</h3><p>这个要稍微说一下。在你关闭了所有定位传感器之后，如果你的手机还是处于有服务的状态下，就可以进行大概定位。通过TelephonyManager获取当前手机信号的基站信息。可以定位到大概区以下的位置。</p><pre><code>MCC，Mobile Country Code，移动国家代码（中国的为460）MNC，Mobile Network Code，移动网络号码（中国移动为00，中国联通为01）LAC，Location Area Code，位置区域码CID，Cell Identity，基站编号，是个16位的数据（范围是0到65535）</code></pre><p>看似类型繁多，但是实际用起来用处不是很多。建议大家还是用第三方定位库吧，简单精准还好用。</p><p>参考文章</p><blockquote><p><a href="https://developer.android.com/guide/topics/location/strategies" target="_blank" rel="noopener">https://developer.android.com/guide/topics/location/strategies</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前朋友问我Tiktok为什么禁用了定位，开启了全局代理，还是可以获取到位置。当时想法只有一个：基站定位。我让他在设置里关掉移动服务（关闭手机卡）之后，确实可以正常使用了。&lt;/p&gt;
&lt;p&gt;这里简单说一下Android中集中定位方式。&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
</feed>
