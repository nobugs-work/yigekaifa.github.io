<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>git-glf</title>
      <link href="/git-glf/"/>
      <url>/git-glf/</url>
      
        <content type="html"><![CDATA[<h2 id="问题出现"><a href="#问题出现" class="headerlink" title="问题出现"></a>问题出现</h2><p>在开发中，一般会有这样的情况，我们需要给同事发一个文件的静态下载地址。通常的选择我们公司都会有自己的samba服务器，但是个别情况下我们会使用git上传后发给对方。</p><p>如果你的文件过大，系统会报错提示：</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fatal: The remote end hung up unexpectedly</span><br></pre></td></tr></table></figure><p>大概意思就是说服务器断开，基本上都是因为服务器或git的限制，不允许传输过大的文件。这里有两种解决方法提供给大家</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="方法1：设置本地限制"><a href="#方法1：设置本地限制" class="headerlink" title="方法1：设置本地限制"></a>方法1：设置本地限制</h3><p>找到你的文档下.git文件夹，打开config文件</p><p>加入</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[http]</span><br><span class="line">postBuffer &#x3D; 524288000</span><br></pre></td></tr></table></figure><p>然后暴力push…</p><p>###方法2：开启git大文件支持插件 git-lfs</p><p>具体你可以查看git-lfs官网：<a href="https://git-lfs.github.com/">https://git-lfs.github.com/</a></p><p>或者跟着下面的步骤进行操作：</p><h4 id="1-安装git-lfs"><a href="#1-安装git-lfs" class="headerlink" title="1.安装git-lfs"></a>1.安装git-lfs</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git lfs install</span><br></pre></td></tr></table></figure><h3 id="2-修改-gitattributes-文件，添加你需要支持的大文件"><a href="#2-修改-gitattributes-文件，添加你需要支持的大文件" class="headerlink" title="2.修改.gitattributes 文件，添加你需要支持的大文件"></a>2.修改.gitattributes 文件，添加你需要支持的大文件</h3><p>例如你需要添加mp4文件，那么你需要在git目录下输入下面的命令</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git lfs track &quot;*.mp4&quot;</span><br><span class="line">&gt; Adding path *.mp4</span><br></pre></td></tr></table></figure><p>注意，这里的.gitattributes请提交到服务器，以免提交大文件后发生冲突。<br>关联文件到你的仓库中</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git add path&#x2F;to&#x2F;file.mp4</span><br></pre></td></tr></table></figure><p>最后commit，push即可，一般在push的时候会有个上传进度。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>提高APP冷启动速度小结</title>
      <link href="/cold-launch-faster/"/>
      <url>/cold-launch-faster/</url>
      
        <content type="html"><![CDATA[<p>在系统完全结束APP的服务之后，冷启动APP仿佛像是生孩子一般难受，尤其是之前版本的支付宝。不过还是要点名表扬一下支付宝，在后续版本尤其是最新的10.0以及之后版本，大力优化了冷启动速度，虽然整个APP还是很重，主页内容还是很多，但是不得不说启动速度的优化还是很明显的。</p><a id="more"></a><p>下面是我工作中对APP启动速度优化的一些总结和看法：</p><p>一 / 去掉白屏背景<br>首先，这个白屏背景是怎么来的呢？</p><p>Android上古时代，APP启动速度几乎只收到了硬件限制。后来，因为ios规定所有APP必须要有闪屏页，切闪屏页需要有图标相对应的内容。这样就使得在打开APP时，非线性动画配合貌似LOGO直接飞到屏幕中间的假效果看起来非常顺滑。Android虽然没有这个规定，但是两端毕竟应该统一。于是，就有了Android闪屏页，其实也就是默认主题的白屏的那一下，它实际上也是用来承接APP打开动效或者欢迎页面的（可以参考现版本的Twitter）。</p><p>这个不是我乱猜的，实际上Android是给了开发者打开APP时闪屏页显示内容的。这个白色背景就是你主题中windowBackground这个属性来控制的。具体方法:</p><p>首先我们需要定义一个XML文件，放置layer-list(图层列表/布局列表，具体使用可以百度)的内容。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;layer-list xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    android:opacity&#x3D;&quot;opaque&quot;&gt;</span><br><span class="line">        &lt;!--给背景透明值，避免颜色闪烁，如果不设置，那么可能会有默认背景色和下面这个属性的一下闪烁交换的情况--&gt;</span><br><span class="line">    &lt;item android:drawable&#x3D;&quot;@android:color&#x2F;black&quot; &#x2F;&gt;</span><br><span class="line">        &lt;!--设置默认背景颜色--&gt;</span><br><span class="line">    &lt;item&gt;</span><br><span class="line">        &lt;bitmap</span><br><span class="line">            android:gravity&#x3D;&quot;center&quot;</span><br><span class="line">            android:src&#x3D;&quot;@mipmap&#x2F;logo&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;item&gt;</span><br><span class="line">    &lt;!--放置logo--&gt;</span><br><span class="line">&lt;&#x2F;layer-list&gt;</span><br></pre></td></tr></table></figure><p>然后直接在你自定义的Theme中使用android:windowBackground去用这个布局即可。</p><p>再退一步说，你可能有自己更复杂的操作或者想法，要去掉这个页面使用自定义的页面，那么你只需要给你的Theme设置两个属性即可：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;item name&#x3D;&quot;android:windowIsTranslucent&quot;&gt;true&lt;&#x2F;item&gt;</span><br><span class="line">&lt;item name&#x3D;&quot;android:windowNoTitle&quot;&gt;true&lt;&#x2F;item&gt;</span><br></pre></td></tr></table></figure><p>或者一行代码：</p><p><code>&lt;item name=&quot;android:windowDisablePreview&quot;&gt;true&lt;/item&gt;</code></p><p>这两种方法我都是不排斥的并且我也有使用过，但是还是推荐按照官方的标准来进行开发。再退一步，请看标题，本文讲的是APP的启动速度优化…</p><p>二 / 及时结束onCreat()方法<br>直到今天，在我们的APP中还存在大量把所有第三方组件初始化工作全部放在onCreat()中的情况。说真的，这个其实是 (官方唯一给出需要优化启动速度的切入点……)[<a href="https://developer.android.com/topic/performance/vitals/launch-time#internals]">https://developer.android.com/topic/performance/vitals/launch-time#internals]</a></p><p>解决方法无非就三种</p><p><code>异步加载，delay加载，按需加载</code></p><p>据我观察，京东APP几乎就用过了上面所有的方法…老版JD中，在初次打开APP时，是不会对一些插件进行加载的。然后在用户退出主页面之后，再次打开时会进行加载（这里要说明一下，如果APP中存在多进程，需要在主进程中加载）并且下载一些SO库（这个操作可以减小APP体积，但是你们要有自己的高速静态空间来保证后续访问）。但是新版京东APP中在首次打开就会delay一下，然后直接下载SO库、加载第三方插件。</p><p>虽然两种切换方式效果几乎没变，但是第一种情况导致的结果就是：我首次打开京东APP，登录页面没有QQ登录…需要退出重新打开才会显示…</p><p>实际上这几种方式不冲突，且可以共存。除了框架开发者要求或者自己使用需要的内容在Application的onCreat()中加载外，像是一些统计插件或者必须插件，建议在启动时进行异步加载；一些非必须功能插件或者登录之后使用功能的插件，建议delay一些时间再进行加载；一些非必须交互或者单页面插件（地图这些），建议按需加载。</p><p>三 / 假加速，‘但是肉眼可见的快了’<br>有一次我负责基础框架部分，我因为失误把启动页指向首页。被组长发现后问我为什么这么写，我说我要再首页中启动闪屏页。又问为什么这么写，这和大家的开发习惯不同。</p><p>我说：在首页做任何操作之前，就在首页启动闪屏页。这样几乎没有增加任何时间，并且可以在打开闪屏页的时候加载首页的数据，这样可以减少用户打开首页的等待时间，这启动速度肉眼可见得快了。说完我当场试了一下，明显没有首页缓冲数据的那一下等待数据的白色页面时间…（说真的，我是临时编的）。</p><p>也就是说，最初是：</p><blockquote><p>原来是：APP启动-&gt;启动闪屏页-&gt;闪屏页展示-&gt;闪屏页结束-&gt;首页-&gt;首页加载数据</p></blockquote><blockquote><p>改变成：APP启动-&gt;首页-&gt;启动闪屏页-&gt;闪屏页展示，同时首页加载数据-&gt;闪屏页结束<br>但是我现在还会这么写…即使首页有缓存的情况下…</p></blockquote><p>虽然这并不是启动加速，但是他就是加速了，我不管。</p><p>四 / MultiDex在5.0之下的问题<br>U1S1，MultiDex就是个大坑，就是个为了打补丁，结果补丁上有个大坑的那种坑。<br>5.0以上的系统不需要在意这个问题，也就是说如果你的安装要求版本&gt;20，那么这篇文章到这里就结束了。 因为5.0之后在安装APK时就会对MultiDex进行了优化，所以Multidex.install(this);几乎不会占用什么时间。</p><p>在5.0以下的系统中， MultiDex （(官方给出的MultiDex在5.0以下使用需要的设置)[<a href="https://developer.android.com/studio/build/multidex#mdex-pre-l]%EF%BC%89">https://developer.android.com/studio/build/multidex#mdex-pre-l]）</a> 就是噩梦…尤其是在老版本或者低配置的设备中，Multidex.install(this);占用的时间远远超过了ANR的反应时间，直接导致了ANR，进不了闪屏页…</p><p>因为现在5.0以下的用户真不多了，我也不想写了。大致思路就是在启动之后hold住主线程，然后异步进程进行dexopt操作，待结束之后发标记回来继续启动APP就可以了。</p><p>这里推荐两个文章，写的都不错：</p><p><a href="https://blog.csdn.net/synaric/article/details/53540760">https://blog.csdn.net/synaric/article/details/53540760</a></p><p><a href="https://www.jianshu.com/p/1a7d8f449b77">https://www.jianshu.com/p/1a7d8f449b77</a></p><p>除此之外，推荐阅读：<a href="https://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&amp;mid=207151651&amp;idx=1&amp;sn=9eab282711f4eb2b4daf2fbae5a5ca9a&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd%20Android%E6%8B%86%E5%88%86%E4%B8%8E%E5%8A%A0%E8%BD%BDDex%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94">https://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&amp;mid=207151651&amp;idx=1&amp;sn=9eab282711f4eb2b4daf2fbae5a5ca9a&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd%20Android%E6%8B%86%E5%88%86%E4%B8%8E%E5%8A%A0%E8%BD%BDDex%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>免 ROOT 卸载 Android 预装软件的思路和实现</title>
      <link href="/unroot-device-uninstall-prv-apps/"/>
      <url>/unroot-device-uninstall-prv-apps/</url>
      
        <content type="html"><![CDATA[<p>苦于各种预装软件垃圾还不给卸载，这边文章被写了出来。（虽然后来我发现有很多）</p><p>首先，从 Android 4.2 开始，设备可以支持多用户，说到这里其实聪明的小朋友已经知道怎么实现了：</p><a id="more"></a><p>卸载当前用户的预装 APP 这种方法用 adb shell 的命令就可以实现，所以你需要提前准备 ADB 工具。具体只需要一行简单的命令：</p><p><code>adb shell pm uninstall --user 0 应用包名</code></p><p>APP 的包名你需要到系统设置-&gt;软件设置-&gt;具体的软件页面去寻找，MIUI 是在右上角的叹号里(或者 MIUI11 之后的版本，你可以长安桌面图标，然后点击弹窗上的小叹号，再点击右上角的小叹号查看)。其他不同的系统不多说明。如果你需要安装回来，只需要使用</p><p><code>adb shell pm install --user 0 应用包名</code></p><p>说一下：</p><p>实际上是卸载掉了，但是只是针对当前用户。如果你切换用户，需要卸载其他用户的 APP 。这个 APP 实际还存在你的prev-app(预装软件)区域内，但他不同于系统的停用操作，是真实卸载掉了的。</p><p>EMUI 和 MIUI的脚本下载地址</p><blockquote><p>链接:<a href="https://pan.baidu.com/s/1gSwPkZLcGguIjaJmtENCHg">https://pan.baidu.com/s/1gSwPkZLcGguIjaJmtENCHg</a> 提取码:d43f 复制这段内容后打开百度网盘手机 App，操作更方便哦</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
            <tag> npm </tag>
            
            <tag> cnpm </tag>
            
            <tag> 源地址 </tag>
            
            <tag> 淘宝源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>两个方法解决git clone慢的问题</title>
      <link href="/how-to-clone-git-faster/"/>
      <url>/how-to-clone-git-faster/</url>
      
        <content type="html"><![CDATA[<p>国内本来就没有git的服务器，所以访问超慢<br>尤其是在个别运营商的加持下，速度更是慢到令人发指。所以我就总结了两个方法来解决这个问题。</p><a id="more"></a><h2 id="方法一：使用gitee复制仓库，然后克隆gitee的仓库-推荐"><a href="#方法一：使用gitee复制仓库，然后克隆gitee的仓库-推荐" class="headerlink" title="方法一：使用gitee复制仓库，然后克隆gitee的仓库[推荐]"></a>方法一：使用gitee复制仓库，然后克隆gitee的仓库[推荐]</h2><p>在登陆<a href="https://gitee.com/">gitee.com</a> 之后，在右上角的加号里点击添加仓库，然后直接往下滑动。</p><p>在下面可以看到</p><p><img src="../img/2.png"></p><p>然后点击<a href="">导入已有仓库</a>之后，在下面输入你需要克隆的仓库即可。</p><p><img src="../img/3.png"></p><blockquote><p>注意：这里如果系统提示你，当前已经存在克隆的仓库，为了避免已经存在的复制仓库有修改或者长时间未更新的情况，建议忽略提示。</p></blockquote><p>优点：方便快捷，而且几十M的库克隆基本都是满速</p><p>问题：个别脚本内置的地址为github的地址，手动修改内容量太大</p><h2 id="方法二：使用代理"><a href="#方法二：使用代理" class="headerlink" title="方法二：使用代理"></a>方法二：使用代理</h2><p>我们在打开代理之后，一般命令行工具是不走代理的，需要手动设置一下，这里我们用<code>powershell</code>做参考</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 注意，这里后面的1080为你的代理的端口，SS和SSR一般为1080,CLASH一般为7891，具体看个人设置</span></span><br><span class="line"><span class="variable">$env</span>:HTTPS_PROXY=<span class="string">&quot;http://127.0.0.1:1080&quot;</span></span><br><span class="line"><span class="variable">$env</span>:HTTP_PROXY=<span class="string">&quot;http://127.0.0.1:1080&quot;</span></span><br></pre></td></tr></table></figure><p>如果不知道自己的代理端口是多少的话，windows下：设置-网络和Intetnet-代理-右面下方有端口显示</p>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> vpn </tag>
            
            <tag> 代理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm切换淘宝源</title>
      <link href="/nodejs-change-source/"/>
      <url>/nodejs-change-source/</url>
      
        <content type="html"><![CDATA[<p>全局配置切换到淘宝源</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><a id="more"></a><p>临时使用淘宝源</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm --registry https://registry.npm.taobao.org install node-red-contrib-composer@latest</span><br></pre></td></tr></table></figure><p>全局配置切换到官方源</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry http://www.npmjs.org</span><br></pre></td></tr></table></figure><p>检测是否切换到了淘宝源</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm info underscore</span><br></pre></td></tr></table></figure><p>另外：</p><blockquote><p>默认的npm下载地址：<a href="http://www.npmjs.org/">http://www.npmjs.org/</a><br>淘宝npm镜像的地址：<a href="https://npm.taobao.org/">https://npm.taobao.org/</a><br>你也可以使用CNPM：<a href="https://cnpmjs.org/">https://cnpmjs.org</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
            <tag> npm </tag>
            
            <tag> cnpm </tag>
            
            <tag> 源地址 </tag>
            
            <tag> 淘宝源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PowerShell禁止执行脚本的解决方法</title>
      <link href="/script-cant-run-on-powershell/"/>
      <url>/script-cant-run-on-powershell/</url>
      
        <content type="html"><![CDATA[<p>如果出现类似下面的提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">无法加载文件 ******.xxx，因为在此系统中禁止执行脚本。有关详细信息，请参阅 <span class="string">&quot;get-help about_signing&quot;</span>。</span><br><span class="line">所在位置 行:1 字符: 17</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>解决方法：</p><a id="more"></a><p>运行<code>Get-ExecutionPolicy</code>。如果返回<code>Restricted</code>，然后运行<code>set-ExecutionPolicy RemoteSigned</code></p><p>然后就可以运行命令了。</p><p>另外如果还不能执行，例如你npm安装的一些命令不能运行，那么请你把<code>C:\Users\用户名\AppData\Roaming\npm</code>添加到系统变量<code>Path</code>里面。</p>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PowerShell </tag>
            
            <tag> Script </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux下DD命令进度查看</title>
      <link href="/dd-cmd-on-linux/"/>
      <url>/dd-cmd-on-linux/</url>
      
        <content type="html"><![CDATA[<p>在Ubuntu 系统上执行如下命令</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dd if=/img.iso of=/dev/mydevice bs=10M count=100000</span><br></pre></td></tr></table></figure><a id="more"></a><p>有的时候，可能会非常耗时，这个时候，如果让dd命令输出执行进度信息，会非常有用。</p><p>重新打开一个Shell，然后执行如下命令即可每秒输出一次进度信息</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">watch -n 1 pkill -USR1 -x dd</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> cmd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自带清除内容功能的EditText</title>
      <link href="/edittext-with-clear-icon/"/>
      <url>/edittext-with-clear-icon/</url>
      
        <content type="html"><![CDATA[<p>出发需求：</p><ol><li>减少手写清除EditText内容的代码</li><li>xml里面写的话，点击清除按钮会失去焦点，然后软键盘消失，需要重复点击输入框才可以继续输入</li></ol><a id="more"></a><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClearEditText</span> <span class="keyword">extends</span> <span class="title">AppCompatEditText</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnFocusChangeListener</span>, <span class="title">View</span>.<span class="title">OnTouchListener</span>, <span class="title">TextWatcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Drawable mClearTextIcon;</span><br><span class="line">    <span class="keyword">private</span> OnFocusChangeListener mOnFocusChangeListener;</span><br><span class="line">    <span class="keyword">private</span> OnTouchListener mOnTouchListener;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isShowClearIcon;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClearEditText</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        init(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClearEditText</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        init(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClearEditText</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        init(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        mClearTextIcon = getCompoundDrawables()[<span class="number">2</span>];</span><br><span class="line">        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.ClearEditText);</span><br><span class="line">        isShowClearIcon = typedArray.getBoolean(R.styleable.ClearEditText_isShowClearIcon, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (mClearTextIcon == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> Drawable drawable = ContextCompat.getDrawable(context, R.mipmap.icon_clear_text);</span><br><span class="line">            <span class="keyword">final</span> Drawable wrapDrawable = DrawableCompat.wrap(drawable);</span><br><span class="line">            DrawableCompat.setTint(wrapDrawable, getCurrentHintTextColor());</span><br><span class="line">            mClearTextIcon = wrapDrawable;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mClearTextIcon.setBounds(<span class="number">0</span>, <span class="number">0</span>, mClearTextIcon.getIntrinsicHeight(), mClearTextIcon.getIntrinsicHeight());</span><br><span class="line">        setClearIconVisible(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">super</span>.setOnFocusChangeListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">super</span>.setOnTouchListener(<span class="keyword">this</span>);</span><br><span class="line">        addTextChangedListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setmOnFocusChangeListener</span><span class="params">(OnFocusChangeListener mOnFocusChangeListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mOnFocusChangeListener = mOnFocusChangeListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setmOnTouchListener</span><span class="params">(OnTouchListener mOnTouchListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mOnTouchListener = mOnTouchListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setClearIconVisible</span><span class="params">(<span class="keyword">boolean</span> visible)</span> </span>&#123;</span><br><span class="line">        mClearTextIcon.setVisible(visible &amp;&amp; isShowClearIcon, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">final</span> Drawable[] compoundDrawables = getCompoundDrawables();</span><br><span class="line">        setCompoundDrawables(</span><br><span class="line">                compoundDrawables[<span class="number">0</span>],</span><br><span class="line">                compoundDrawables[<span class="number">1</span>],</span><br><span class="line">                visible ? mClearTextIcon : <span class="keyword">null</span>,</span><br><span class="line">                compoundDrawables[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFocusChange</span><span class="params">(View v, <span class="keyword">boolean</span> hasFocus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hasFocus) &#123;</span><br><span class="line">            setClearIconVisible(getText().length() &gt; <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setClearIconVisible(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mOnFocusChangeListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mOnFocusChangeListener.onFocusChange(v, hasFocus);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent motionEvent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) motionEvent.getX();</span><br><span class="line">        <span class="keyword">if</span> (mClearTextIcon.isVisible() &amp;&amp; x &gt; getWidth() - getPaddingRight() - mClearTextIcon.getIntrinsicWidth()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (motionEvent.getAction() == motionEvent.ACTION_UP) &#123;</span><br><span class="line">                setError(<span class="keyword">null</span>);</span><br><span class="line">                setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (mOnTouchListener != <span class="keyword">null</span> &amp;&amp; mOnTouchListener.onTouch(v, motionEvent));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isShowClearIcon</span><span class="params">(<span class="keyword">boolean</span> isShowClearIcon)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isShowClearIcon = isShowClearIcon;</span><br><span class="line">        setClearIconVisible(getText().length() &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence text, <span class="keyword">int</span> start, <span class="keyword">int</span> lengthBefore, <span class="keyword">int</span> lengthAfter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isFocused()) &#123;</span><br><span class="line">            setClearIconVisible(text.length() &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>attrs：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;ClearEditText&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--是否需要展示清除按钮--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;isShowClearIcon&quot;</span> <span class="attr">format</span>=<span class="string">&quot;boolean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xxx.ClearEditText</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--some parms here--&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--set is show the icon here--&gt;</span></span><br><span class="line">    app:isShowClearIcon = &quot;true&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ClearEditText</span>&gt;</span></span><br></pre></td></tr></table></figure><p>或者在<code>java</code>代码中:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">clearTextView.isShowClearIcon(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Edittext </tag>
            
            <tag> Custom </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>监听布局内所有的EditText</title>
      <link href="/listen-all-edittext-in-your-layout/"/>
      <url>/listen-all-edittext-in-your-layout/</url>
      
        <content type="html"><![CDATA[<p>当出现布局内有N个输入框且需要同步监听，例如你需要监听用户输入所有内容之后才可以点击下一步的控件，你可以试试下面这个控件。</p><a id="more"></a><h2 id="1-获取子view"><a href="#1-获取子view" class="headerlink" title="1. 获取子view"></a>1. 获取子view</h2><p>编历布局，看当前布局有几个<code>EditText</code>,然后去监听拿到<code>focus</code>的<code>view</code></p><p>获取子<code>view</code>的方式：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遍历viewGroup</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">traverseViewGroup</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> viewCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == view) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;</span><br><span class="line">            <span class="comment">//遍历ViewGroup,是子view加1，是ViewGroup递归调用</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ((ViewGroup) view).getChildCount(); i++) &#123;</span><br><span class="line">                View child = ((ViewGroup) view).getChildAt(i);</span><br><span class="line">                <span class="keyword">if</span> (child <span class="keyword">instanceof</span> ViewGroup) &#123;</span><br><span class="line">                    viewCount += traverseViewGroup(((ViewGroup) view).getChildAt(i));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    viewCount++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            viewCount++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> viewCount;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>非递归方法获取子<code>view</code>：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遍历viewGroup</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">traverseViewGroup</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> viewCount = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">null</span> == view) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;</span><br><span class="line">           ViewGroup viewGroup = (ViewGroup) view;</span><br><span class="line">           LinkedList&lt;ViewGroup&gt; linkedList = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">           linkedList.add(viewGroup);</span><br><span class="line">           <span class="keyword">while</span> (!linkedList.isEmpty()) &#123;</span><br><span class="line">               <span class="comment">//removeFirst()删除第一个元素，并返回该元素</span></span><br><span class="line">               ViewGroup current = linkedList.removeFirst();</span><br><span class="line">               viewCount++;</span><br><span class="line">               <span class="comment">//遍历linkedList中第一个viewGroup中的子view</span></span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; current.getChildCount(); i++) &#123;</span><br><span class="line">                   <span class="keyword">if</span> (current.getChildAt(i) <span class="keyword">instanceof</span> ViewGroup) &#123;</span><br><span class="line">                       linkedList.addLast((ViewGroup) current.getChildAt(i));</span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                       viewCount++;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           viewCount++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> viewCount;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>获取到子<code>view</code>的时候，你需要判断这个子<code>view</code>是不是<code>EditText</code>，方法有两种：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">v.getClassName() == <span class="string">&quot;EditText&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">v <span class="keyword">instanceof</span> Button</span><br></pre></td></tr></table></figure><h2 id="2-拿到子view之后："><a href="#2-拿到子view之后：" class="headerlink" title="2. 拿到子view之后："></a>2. 拿到子view之后：</h2><p>方法1. 拿到子<code>view</code>之后，不需要每个都去监听（当然你也可以这么做），另外一种，判断在<code>viewgroup</code>中哪个子<code>view</code>获取到了焦点，然后给他添加监听，其他的移除监听。</p><p>然后给设置的按钮去设置<code>enable</code></p><p>方法2. LiveData监听数据变化，但是和上面的方式换汤不换药，代码量更多了一点。LiveData的具体使用可以参考： <a href="https://developer.android.google.cn/reference/android/arch/lifecycle/LiveData">https://developer.android.google.cn/reference/android/arch/lifecycle/LiveData</a></p><h3 id="需要完成的内容："><a href="#需要完成的内容：" class="headerlink" title="需要完成的内容："></a>需要完成的内容：</h3><ul><li><input checked="" disabled="" type="checkbox"> 添加例外的参数，例如非必填的Edittext</li></ul>]]></content>
      
      
      <categories>
          
          <category> Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Edittext </tag>
            
            <tag> ViewGroup </tag>
            
            <tag> CustomView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>startWithPop()出现两个Fragment都退出的情况</title>
      <link href="/startwithpop-close-both-fragment/"/>
      <url>/startwithpop-close-both-fragment/</url>
      
        <content type="html"><![CDATA[<p>有时候<code>startWithPop()</code>会出现两个<code>Fragment</code>都出栈的情况，一般当前<code>fragment</code>是RootView的时候会出现这个情况。</p><a id="more"></a><p>解决方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">((BaseFragment) getParentFragment()).start(toFragment);</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">popTo(A.class,<span class="keyword">true</span>,<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            start(B);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;,getFragmentAnimator().getPopExit()); <span class="comment">// getFragmentAnimator().getPopExit() 代表popTo时的动画</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> startWithPop </tag>
            
            <tag> Fragment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TabLayout的简单修改</title>
      <link href="/some-changes-for-tablayout/"/>
      <url>/some-changes-for-tablayout/</url>
      
        <content type="html"><![CDATA[<p>设计稿上的tab布局我用了design库的tablayout，根据设计上的图来看，选中的tab要是粗体，下方横线等宽于字体。</p><a id="more"></a><h3 id="问题1：TabLayout无法控制当前选中的行的字体"><a href="#问题1：TabLayout无法控制当前选中的行的字体" class="headerlink" title="问题1：TabLayout无法控制当前选中的行的字体"></a>问题1：TabLayout无法控制当前选中的行的字体</h3><p>解决方案：<code>setCustomView()</code> 。</p><p>首先写一个方法，用来返回每个tab的view：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getTabView</span><span class="params">(<span class="keyword">int</span> position, String title)</span> </span>&#123;</span><br><span class="line">    View view = LayoutInflater.from(getContext()).inflate(R.layout.tab_item, <span class="keyword">null</span>);</span><br><span class="line">    TextView txt_title = (TextView) view.findViewById(R.id.textView);</span><br><span class="line">    txt_title.setText(title);</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后把view设置到tablayout中：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">tabLayout.getTabAt(<span class="number">0</span>).setCustomView(getTabView(<span class="number">0</span>, <span class="string">&quot;全部&quot;</span>));</span><br></pre></td></tr></table></figure><p>然后去选择控制tablayout的标签的样式，我是新建了一个OnTabSelectedListener，然后再里面进行设置的</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">OnTabSelectedListener onTabSelectedListener = <span class="keyword">new</span> TabLayout.OnTabSelectedListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabSelected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 选中的tab设置为粗体</span></span><br><span class="line">                TextView textView = tabLayout.getTabAt(tab.getPosition()).getCustomView().findViewById(R.id.textView);</span><br><span class="line">                textView.setTypeface(<span class="keyword">null</span>, Typeface.BOLD);</span><br><span class="line">                viewPager.setCurrentItem(tab.getPosition());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabUnselected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 未选中的tab设置为正常</span></span><br><span class="line">                TextView textView = tabLayout.getTabAt(tab.getPosition()).getCustomView().findViewById(R.id.textView);</span><br><span class="line">                textView.setTypeface(<span class="keyword">null</span>, Typeface.NORMAL);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabReselected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>但是，设置好之后出现了新的问题：</p><h3 id="问题2：下面Indicator宽度始终为最宽的宽度"><a href="#问题2：下面Indicator宽度始终为最宽的宽度" class="headerlink" title="问题2：下面Indicator宽度始终为最宽的宽度"></a>问题2：下面<code>Indicator</code>宽度始终为最宽的宽度</h3><p>即使你设置了<code>app:tabIndicatorFullWidth=&quot;true&quot;</code>，因为<code>tabIndicatorFullWidth</code>是根据默认布局的文字宽度来设置的，我们自定义布局之后，系统无法获取到文字大小和长度，所以就会设置成最宽的宽度。</p><p>我的解决方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reflex</span><span class="params">(<span class="keyword">final</span> TabLayout tabLayout)</span> </span>&#123;</span><br><span class="line">        tabLayout.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    LinearLayout mTabStrip = (LinearLayout) tabLayout.getChildAt(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mTabStrip.getChildCount(); i++) &#123;</span><br><span class="line">                        View tabView = mTabStrip.getChildAt(i);</span><br><span class="line"></span><br><span class="line">                        Field mTextViewField = tabView.getClass().getDeclaredField(<span class="string">&quot;textView&quot;</span>);</span><br><span class="line">                        mTextViewField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">                        TextView mTextView = (TextView) mTextViewField.get(tabView);</span><br><span class="line"></span><br><span class="line">                        tabView.setPadding(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">int</span> width = <span class="number">0</span>;</span><br><span class="line">                        width = mTextView.getWidth();</span><br><span class="line">                        <span class="keyword">if</span> (width == <span class="number">0</span>) &#123;</span><br><span class="line">                            mTextView.measure(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                            width = mTextView.getMeasuredWidth();</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        LinearLayout.LayoutParams params = (LinearLayout.LayoutParams) tabView.getLayoutParams();</span><br><span class="line">                        params.width = width;</span><br><span class="line"></span><br><span class="line">                        WindowManager wm1 = ((Activity) getContext()).getWindowManager();</span><br><span class="line">                        <span class="keyword">int</span> width1 = wm1.getDefaultDisplay().getWidth();</span><br><span class="line">                        LogUtils.d(<span class="string">&quot;&quot;</span> + width1 / tabLayout.getTabCount() + <span class="string">&quot;=============&quot;</span> + mTextView.getText().length() * dip2px(tabLayout.getContext(), <span class="number">15</span>));</span><br><span class="line"></span><br><span class="line">                        params.leftMargin = (width1 / tabLayout.getTabCount() - mTextView.getText().length() * dip2px(tabLayout.getContext(), <span class="number">15</span>)) / <span class="number">2</span>;</span><br><span class="line">                        params.rightMargin = (width1 / tabLayout.getTabCount() - mTextView.getText().length() * dip2px(tabLayout.getContext(), <span class="number">15</span>)) / <span class="number">2</span>;</span><br><span class="line">                        tabView.setLayoutParams(params);</span><br><span class="line"></span><br><span class="line">                        tabView.invalidate();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dip2px</span><span class="params">(Context context, <span class="keyword">float</span> dpValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> scale = context.getResources().getDisplayMetrics().density;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (dpValue * scale + <span class="number">0.5f</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>reflex(tabLayout);</code>调用在所有<code>getTabAt</code>方法之后即可解决这个，但是还有点小问题，tab大小被设置成了文字宽度…这个问题暂时保留，下次解决。另外有几个小问题</p><ol><li>去掉tab的水波纹效果，无论是support还是AdnroidX，都用<code>app:tabRippleColor=&quot;@android:color/transparent&quot;</code>，<code>app:tabBackground=&quot;@android:color/transparent&quot;</code>即使在support下也无效</li></ol>]]></content>
      
      
      <categories>
          
          <category> Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TabLayout </tag>
            
            <tag> widget </tag>
            
            <tag> custom </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android中几种定位方式的粗解</title>
      <link href="/some-way-to-get-location/"/>
      <url>/some-way-to-get-location/</url>
      
        <content type="html"><![CDATA[<p>之前朋友问我Tiktok为什么禁用了定位，开启了全局代理，还是可以获取到位置。当时想法只有一个：基站定位。我让他在设置里关掉移动服务（关闭手机卡）之后，确实可以正常使用了。</p><p>这里简单说一下Android中集中定位方式。</p><a id="more"></a><blockquote><p>这里是在Android10添加的新权限，在后台获取位置：<a href="https://developer.android.com/reference/android/Manifest.permission.html#ACCESS_BACKGROUND_LOCATION">https://developer.android.com/reference/android/Manifest.permission.html#ACCESS_BACKGROUND_LOCATION</a></p></blockquote><h2 id="1-GPS"><a href="#1-GPS" class="headerlink" title="1. GPS"></a>1. GPS</h2><p>权限（注意版本变化）：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>具体定位代码</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> locManager = getSystemService(Context.LOCATION_SERVICE) as LocationManager</span><br><span class="line"><span class="keyword">var</span> loc = locManager.getLastKnownLocation(LocationManager.GPS_PROVIDER)</span><br><span class="line"><span class="keyword">if</span>(loc != <span class="keyword">null</span>)&#123;</span><br><span class="line">    Log.e(<span class="string">&quot;gpslocation&quot;</span>, loc.toString())</span><br><span class="line">    toast(loc.toString())</span><br><span class="line">&#125;</span><br><span class="line">locManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, <span class="number">0</span>, <span class="number">0F</span>, object : LocationListener&#123;</span><br><span class="line">    <span class="function">override fun <span class="title">onStatusChanged</span><span class="params">(provider: String?, status: Int, extras: Bundle?)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">override fun <span class="title">onProviderEnabled</span><span class="params">(provider: String?)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">override fun <span class="title">onProviderDisabled</span><span class="params">(provider: String?)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">override fun <span class="title">onLocationChanged</span><span class="params">(location: Location?)</span> </span>&#123;</span><br><span class="line">        Log.e(<span class="string">&quot;gpslocation&quot;</span>, location.toString())</span><br><span class="line">        toast(location.toString())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-Network获取位置"><a href="#2-Network获取位置" class="headerlink" title="2. Network获取位置"></a>2. Network获取位置</h3><p>与GPS定位相同，代码都一样。只是申请权限不同。并且在室内时，GPS需要一定时间来定位，而Network在网络状况不好时不可用。</p><h3 id="3-IP"><a href="#3-IP" class="headerlink" title="3. IP"></a>3. IP</h3><p>APP通过对当前IP的分析，可以得到你大致的位置。一般不采用这种方案，IP太容易被伪装。</p><h3 id="4-WiFi（WLAN）定位"><a href="#4-WiFi（WLAN）定位" class="headerlink" title="4. WiFi（WLAN）定位"></a>4. WiFi（WLAN）定位</h3><p>需要权限：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>这个也比较简单，就是过程就是拿到当前的WiFi信息，然后通过mac地址（BSSID）进行查询。具体查询的接口可以去聚合数据搜索一下，这里不再多说。</p><h3 id="5-基站定位"><a href="#5-基站定位" class="headerlink" title="5. 基站定位"></a>5. 基站定位</h3><p>这个要稍微说一下。在你关闭了所有定位传感器之后，如果你的手机还是处于有服务的状态下，就可以进行大概定位。通过TelephonyManager获取当前手机信号的基站信息。可以定位到大概区以下的位置。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MCC，Mobile Country Code，移动国家代码（中国的为460）</span><br><span class="line">MNC，Mobile Network Code，移动网络号码（中国移动为00，中国联通为01）</span><br><span class="line">LAC，Location Area Code，位置区域码</span><br><span class="line">CID，Cell Identity，基站编号，是个16位的数据（范围是0到65535）</span><br></pre></td></tr></table></figure><p>看似类型繁多，但是实际用起来用处不是很多。建议大家还是用第三方定位库吧，简单精准还好用。</p><p>参考文章</p><blockquote><p><a href="https://developer.android.com/guide/topics/location/strategies">https://developer.android.com/guide/topics/location/strategies</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Location </tag>
            
            <tag> 定位 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
