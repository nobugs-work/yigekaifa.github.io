<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> TabLayout的简单修改 · 一个开发</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="TabLayout的简单修改 - 一个开发"><meta name="keywords"><meta name="author" content="一个开发"><link rel="short icon" href="/logo.png"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://yigekaifa.com/atom.xml" title="一个开发"><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="一个开发" type="application/atom+xml">
</head><body><header><div class="header row"> <ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="首页" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">TabLayout的简单修改</h1><div class="post-info">2020-03-10</div><div class="post-content"><p>设计稿上的tab布局我用了design库的tablayout，根据设计上的图来看，选中的tab要是粗体，下方横线等宽于字体。</p>
<a id="more"></a>

<h3 id="问题1：TabLayout无法控制当前选中的行的字体"><a href="#问题1：TabLayout无法控制当前选中的行的字体" class="headerlink" title="问题1：TabLayout无法控制当前选中的行的字体"></a>问题1：TabLayout无法控制当前选中的行的字体</h3><p>解决方案：<code>setCustomView()</code> 。</p>
<p>首先写一个方法，用来返回每个tab的view：</p>
<pre><code class="java">    public View getTabView(int position, String title) {
        View view = LayoutInflater.from(getContext()).inflate(R.layout.tab_item, null);
        TextView txt_title = (TextView) view.findViewById(R.id.textView);
        txt_title.setText(title);
        return view;
    }</code></pre>
<p>然后把view设置到tablayout中：</p>
<pre><code class="java">tabLayout.getTabAt(0).setCustomView(getTabView(0, &quot;全部&quot;));</code></pre>
<p>然后去选择控制tablayout的标签的样式，我是新建了一个OnTabSelectedListener，然后再里面进行设置的</p>
<pre><code class="java">OnTabSelectedListener onTabSelectedListener = new TabLayout.OnTabSelectedListener() {
            @Override
            public void onTabSelected(TabLayout.Tab tab) {
                // 选中的tab设置为粗体
                TextView textView = tabLayout.getTabAt(tab.getPosition()).getCustomView().findViewById(R.id.textView);
                textView.setTypeface(null, Typeface.BOLD);
                viewPager.setCurrentItem(tab.getPosition());
            }

            @Override
            public void onTabUnselected(TabLayout.Tab tab) {
                // 未选中的tab设置为正常
                TextView textView = tabLayout.getTabAt(tab.getPosition()).getCustomView().findViewById(R.id.textView);
                textView.setTypeface(null, Typeface.NORMAL);

            }

            @Override
            public void onTabReselected(TabLayout.Tab tab) {

            }
        };</code></pre>
<p>但是，设置好之后出现了新的问题：</p>
<h3 id="问题2：下面Indicator宽度始终为最宽的宽度"><a href="#问题2：下面Indicator宽度始终为最宽的宽度" class="headerlink" title="问题2：下面Indicator宽度始终为最宽的宽度"></a>问题2：下面<code>Indicator</code>宽度始终为最宽的宽度</h3><p>即使你设置了<code>app:tabIndicatorFullWidth=&quot;true&quot;</code>，因为<code>tabIndicatorFullWidth</code>是根据默认布局的文字宽度来设置的，我们自定义布局之后，系统无法获取到文字大小和长度，所以就会设置成最宽的宽度。</p>
<p>我的解决方法：</p>
<pre><code class="java">public void reflex(final TabLayout tabLayout) {
        tabLayout.post(new Runnable() {
            @Override
            public void run() {
                try {
                    LinearLayout mTabStrip = (LinearLayout) tabLayout.getChildAt(0);
                    for (int i = 0; i &lt; mTabStrip.getChildCount(); i++) {
                        View tabView = mTabStrip.getChildAt(i);

                        Field mTextViewField = tabView.getClass().getDeclaredField(&quot;textView&quot;);
                        mTextViewField.setAccessible(true);

                        TextView mTextView = (TextView) mTextViewField.get(tabView);

                        tabView.setPadding(0, 0, 0, 0);

                        int width = 0;
                        width = mTextView.getWidth();
                        if (width == 0) {
                            mTextView.measure(0, 0);
                            width = mTextView.getMeasuredWidth();
                        }

                        LinearLayout.LayoutParams params = (LinearLayout.LayoutParams) tabView.getLayoutParams();
                        params.width = width;

                        WindowManager wm1 = ((Activity) getContext()).getWindowManager();
                        int width1 = wm1.getDefaultDisplay().getWidth();
                        LogUtils.d(&quot;&quot; + width1 / tabLayout.getTabCount() + &quot;=============&quot; + mTextView.getText().length() * dip2px(tabLayout.getContext(), 15));

                        params.leftMargin = (width1 / tabLayout.getTabCount() - mTextView.getText().length() * dip2px(tabLayout.getContext(), 15)) / 2;
                        params.rightMargin = (width1 / tabLayout.getTabCount() - mTextView.getText().length() * dip2px(tabLayout.getContext(), 15)) / 2;
                        tabView.setLayoutParams(params);

                        tabView.invalidate();
                    }

                } catch (NoSuchFieldException e) {
                    e.printStackTrace();
                } catch (IllegalAccessException e) {
                    e.printStackTrace();
                }
            }
        });

    }

    public static int dip2px(Context context, float dpValue) {
        float scale = context.getResources().getDisplayMetrics().density;
        return (int) (dpValue * scale + 0.5f);
    }</code></pre>
<p><code>reflex(tabLayout);</code>调用在所有<code>getTabAt</code>方法之后即可解决这个，但是还有点小问题，tab大小被设置成了文字宽度…这个问题暂时保留，下次解决。另外有几个小问题</p>
<ol>
<li>去掉tab的水波纹效果，无论是support还是AdnroidX，都用<code>app:tabRippleColor=&quot;@android:color/transparent&quot;</code>，<code>app:tabBackground=&quot;@android:color/transparent&quot;</code>即使在support下也无效</li>
</ol>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/startwithpop-close-both-fragment/" title="startWithPop()出现两个Fragment都退出的情况" class="prev">PREV</a><a href="/some-way-to-get-location/" title="Android中几种定位方式的粗解" class="next">NEXT</a></div><div class="copyright"><p>© 2020 <a target="_blank">一个开发</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p> <span style="padding-right: 6px;">闽ICP备16007301号-2</span></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/ar-anchor.js"></script><script src="/scripts/main.js"></script></body></html>